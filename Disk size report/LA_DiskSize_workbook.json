{
  "version": "Notebook/1.0",
  "items": [
    {
      "type": 1,
      "content": {
        "json": "## Disk size report: analyze what's taking up place\n---\nThis workbook allows you to know:\n- Total disk size and free space\n- OneDrive and size on disk\n- Devices with OneDrive option Always keep on device enabled\n- Devices with less than 20% of free space\n- What take more space on those devices\n",
        "style": "info"
      },
      "name": "text - 2"
    },
    {
      "type": 11,
      "content": {
        "version": "LinkItem/1.0",
        "style": "tabs",
        "links": [
          {
            "id": "24080275-ac40-4b0b-97ec-22ea9b566e4d",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "Disk size resume",
            "subTarget": "DiskSizeResume",
            "style": "link"
          },
          {
            "id": "8ec93b5a-0ecb-46c4-975b-cba3bc3fa956",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "OneDrive usage on disk",
            "subTarget": "OneDriveUsage",
            "style": "link"
          },
          {
            "id": "80f2960b-288d-4db2-be59-4d21fc9a2816",
            "cellValue": "selectedTab",
            "linkTarget": "parameter",
            "linkLabel": "View larger content on disk",
            "subTarget": "LargerContent",
            "style": "link"
          }
        ]
      },
      "name": "links - 7"
    },
    {
      "type": 12,
      "content": {
        "version": "NotebookGroup/1.0",
        "groupType": "editable",
        "items": [
          {
            "type": 3,
            "content": {
              "version": "KqlItem/1.0",
              "query": "DiskSize_CL\r\n| summarize DiskSize_CL = count() by DiskFreeSpaceState_s",
              "size": 4,
              "title": "Free space in %",
              "timeContext": {
                "durationMs": 86400000
              },
              "queryType": 0,
              "resourceType": "microsoft.operationalinsights/workspaces",
              "visualization": "piechart",
              "chartSettings": {
                "seriesLabelSettings": [
                  {
                    "seriesName": "OK",
                    "label": "Between 20 and 70",
                    "color": "blue"
                  },
                  {
                    "seriesName": "Warning",
                    "label": "Between 10 and 20",
                    "color": "orange"
                  },
                  {
                    "seriesName": "Alert",
                    "label": "Lesser than 10",
                    "color": "redBright"
                  },
                  {
                    "seriesName": "Awesome",
                    "label": "Greater than 70",
                    "color": "green"
                  }
                ]
              }
            },
            "customWidth": "50",
            "name": "query - 5",
            "styleSettings": {
              "maxWidth": "50"
            }
          }
        ]
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "DiskSizeResume"
      },
      "name": "group - 7",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "DiskSize_CL\r\n| summarize DiskSize_CL = count() by AlwaysKeepDevice_s",
        "size": 4,
        "title": "Devices with Always keep on device checked at OneDrive root",
        "timeContext": {
          "durationMs": 86400000
        },
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "piechart",
        "chartSettings": {
          "seriesLabelSettings": [
            {
              "seriesName": "Non",
              "label": "Not enabled",
              "color": "green"
            },
            {
              "seriesName": "Oui",
              "label": "Enabled",
              "color": "redBright"
            }
          ]
        }
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "OneDriveUsage"
      },
      "name": "query - 4",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "DiskSize_CL\n| project Computer=ComputerName_s, FreeSpace_percent=HardDiskFreeSpacePercent_d, OneDrive_Percent=ODUsedSizePercent_d,\n['Disk size']=HardDiskSizeMb_d,['Disk freespace']=HardDiskSizeFreeSpaceMb_d,\n['OneDrive size']=OneDriveFullSizeMb_d,OneDrive_SizeOnDisk=OneDriveSizeOnDiskMb_d,\n['Desktop size']=DesktopSizeMb_d,Desktop_SizeOnDisk=DesktopSizeOnDiskMb_d,\n['Documents size']=DocumentsSizeMb_d,Documents_SizeOnDisk=DocumentsSizeOnDiskMb_d,\n['Pictures size']=PicturesSizeMb_d,Pictures_SizeOnDisk=PicturesSizeOnDiskMb_d",
        "size": 4,
        "title": "Devices with details",
        "timeContext": {
          "durationMs": 86400000
        },
        "exportFieldName": "Computer",
        "exportParameterName": "ComputerName_s",
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "FreeSpace_percent",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": "<",
                    "thresholdValue": "10",
                    "representation": "redBright",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "<",
                    "thresholdValue": "20",
                    "representation": "orange",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": ">",
                    "thresholdValue": "20",
                    "representation": "green",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "text": "{0}{1}"
                  }
                ]
              },
              "numberFormat": {
                "unit": 1,
                "options": {
                  "style": "decimal"
                }
              }
            },
            {
              "columnMatch": "OneDrive_Percent",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": ">",
                    "thresholdValue": "50",
                    "representation": "orange",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "<",
                    "thresholdValue": "50",
                    "representation": "green",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": ">",
                    "thresholdValue": "70",
                    "representation": "redBright",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "text": "{0}{1}"
                  }
                ]
              },
              "numberFormat": {
                "unit": 1,
                "options": {
                  "style": "decimal",
                  "maximumFractionDigits": 1
                }
              }
            },
            {
              "columnMatch": "Disk size",
              "formatter": 0,
              "numberFormat": {
                "unit": 4,
                "options": {
                  "style": "decimal",
                  "maximumFractionDigits": 2
                }
              }
            },
            {
              "columnMatch": "Disk freespace",
              "formatter": 0,
              "numberFormat": {
                "unit": 4,
                "options": {
                  "style": "decimal",
                  "maximumFractionDigits": 2
                }
              }
            },
            {
              "columnMatch": "OneDrive size",
              "formatter": 0,
              "numberFormat": {
                "unit": 4,
                "options": {
                  "style": "decimal",
                  "maximumFractionDigits": 2
                }
              }
            },
            {
              "columnMatch": "OneDrive_SizeOnDisk",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": ">",
                    "thresholdValue": "50000",
                    "representation": "orange",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "<",
                    "thresholdValue": "50000",
                    "representation": "green",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": null,
                    "text": "{0}{1}"
                  }
                ]
              },
              "numberFormat": {
                "unit": 4,
                "options": {
                  "style": "decimal",
                  "maximumFractionDigits": 2
                }
              }
            },
            {
              "columnMatch": "Desktop size",
              "formatter": 0,
              "numberFormat": {
                "unit": 4,
                "options": {
                  "style": "decimal",
                  "maximumFractionDigits": 2
                }
              }
            },
            {
              "columnMatch": "Desktop_SizeOnDisk",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": null,
                    "text": "{0}{1}"
                  }
                ]
              },
              "numberFormat": {
                "unit": 4,
                "options": {
                  "style": "decimal",
                  "maximumFractionDigits": 2
                }
              }
            },
            {
              "columnMatch": "Documents size",
              "formatter": 0,
              "numberFormat": {
                "unit": 4,
                "options": {
                  "style": "decimal",
                  "maximumFractionDigits": 2
                }
              }
            },
            {
              "columnMatch": "Documents_SizeOnDisk",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": "<",
                    "thresholdValue": "40000",
                    "representation": "green",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": ">",
                    "thresholdValue": "40000",
                    "representation": "orange",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": null,
                    "text": "{0}{1}"
                  }
                ]
              },
              "numberFormat": {
                "unit": 4,
                "options": {
                  "style": "decimal",
                  "maximumFractionDigits": 2
                }
              }
            },
            {
              "columnMatch": "Pictures size",
              "formatter": 0,
              "numberFormat": {
                "unit": 4,
                "options": {
                  "style": "decimal",
                  "maximumFractionDigits": 2
                }
              }
            },
            {
              "columnMatch": "Pictures_SizeOnDisk",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": "<",
                    "thresholdValue": "40000",
                    "representation": "green",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": ">",
                    "thresholdValue": "40000",
                    "representation": "orange",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": null,
                    "text": "{0}{1}"
                  }
                ]
              },
              "numberFormat": {
                "unit": 4,
                "options": {
                  "style": "decimal",
                  "maximumFractionDigits": 2
                }
              }
            },
            {
              "columnMatch": "Disk_Size",
              "formatter": 0,
              "numberFormat": {
                "unit": 4,
                "options": {
                  "style": "decimal",
                  "maximumFractionDigits": 2
                }
              }
            },
            {
              "columnMatch": "Disk_FreeSpace",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": null,
                    "text": "{0}{1}"
                  }
                ]
              },
              "numberFormat": {
                "unit": 4,
                "options": {
                  "style": "decimal",
                  "maximumFractionDigits": 2
                }
              }
            },
            {
              "columnMatch": "OneDrive_Size",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": null,
                    "text": "{0}{1}"
                  }
                ]
              },
              "numberFormat": {
                "unit": 4,
                "options": {
                  "style": "decimal",
                  "maximumFractionDigits": 2
                }
              }
            },
            {
              "columnMatch": "Desktop_Size",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": null,
                    "text": "{0}{1}"
                  }
                ]
              },
              "numberFormat": {
                "unit": 4,
                "options": {
                  "style": "decimal",
                  "maximumFractionDigits": 2
                }
              }
            },
            {
              "columnMatch": "Documents_Size",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": null,
                    "text": "{0}{1}"
                  }
                ]
              },
              "numberFormat": {
                "unit": 4,
                "options": {
                  "style": "decimal",
                  "maximumFractionDigits": 2
                }
              }
            },
            {
              "columnMatch": "Pictures_Size",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "representation": null,
                    "text": "{0}{1}"
                  }
                ]
              },
              "numberFormat": {
                "unit": 4,
                "options": {
                  "style": "decimal",
                  "maximumFractionDigits": 2
                }
              }
            },
            {
              "columnMatch": "Disk_FreeSpace_percent",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": "<",
                    "thresholdValue": "10",
                    "representation": "redBright",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": ">",
                    "thresholdValue": "10",
                    "representation": "green",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "text": "{0}{1}"
                  }
                ]
              },
              "numberFormat": {
                "unit": 1,
                "options": {
                  "style": "decimal"
                }
              }
            }
          ]
        },
        "sortBy": []
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "DiskSizeResume"
      },
      "name": "query - 2",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "DiskSize_CL\r\n| where HardDiskFreeSpacePercent_d < 20\r\n| summarize arg_max (TimeGenerated, *) by ComputerName_s\r\n| project Computer=ComputerName_s, \r\n['Top 10 folders']=Top10CurrentUserFolder_s",
        "size": 4,
        "title": "10 larger folders in current user profile for devices with less than 20% free space",
        "timeContext": {
          "durationMs": 86400000
        },
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "gridSettings": {
          "filter": true
        }
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "LargerContent"
      },
      "name": "query - 8",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "DiskSize_CL\r\n| summarize DiskSize_CL = count() by OneDriveUseSizeState_s",
        "size": 4,
        "title": "Onedrive size on disk in %",
        "timeContext": {
          "durationMs": 86400000
        },
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "visualization": "piechart",
        "chartSettings": {
          "seriesLabelSettings": [
            {
              "seriesName": "OK",
              "label": "Between 10 and 40",
              "color": "blue"
            },
            {
              "seriesName": "Awesome",
              "label": "Lesser then 10",
              "color": "green"
            },
            {
              "seriesName": "Warning",
              "label": "Between 40 and 50",
              "color": "orange"
            },
            {
              "seriesName": "Alert",
              "label": "Greater than 50",
              "color": "redBright"
            }
          ]
        }
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "OneDriveUsage"
      },
      "name": "query - 10",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "DiskSize_CL\r\n| summarize arg_max (TimeGenerated, *) by ComputerName_s\r\n| project Computer=ComputerName_s, AlwaysKeepDevice=AlwaysKeepDevice_s, ['Disk freeSpace percent']=HardDiskFreeSpacePercent_d\r\n| where AlwaysKeepDevice == \"Oui\"\r\n\r\n",
        "size": 4,
        "title": "Devices with Always keep on device enabled at OneDrive root",
        "timeContext": {
          "durationMs": 86400000
        },
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Disk freeSpace percent",
              "formatter": 0,
              "numberFormat": {
                "unit": 1,
                "options": {
                  "style": "decimal"
                }
              }
            }
          ]
        }
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "OneDriveUsage"
      },
      "name": "query - 6",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "DiskSize_CL\r\n| where HardDiskFreeSpacePercent_d < 20\r\n| summarize arg_max (TimeGenerated, *) by ComputerName_s\r\n| project Computer=ComputerName_s, ['Top 10 folders']=Top10UsersFolder_s\r\n",
        "size": 4,
        "title": "10 larger folders in C:\\Users (all users) for devices with less than 20% free space",
        "timeContext": {
          "durationMs": 86400000
        },
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "Disk freespace",
              "formatter": 0,
              "numberFormat": {
                "unit": 4,
                "options": {
                  "style": "decimal"
                }
              }
            }
          ],
          "filter": true
        }
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "LargerContent"
      },
      "name": "Group - LargerContent",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "DiskSize_CL\r\n| where HardDiskFreeSpacePercent_d < 20\r\n| summarize arg_max (TimeGenerated, *) by ComputerName_s\r\n| project Computer=ComputerName_s, \r\n['Top 10 folders']=Top10CFolder_s\r\n",
        "size": 4,
        "title": " 10 larger folders in C:\\ for devices with less than 20% free space",
        "timeContext": {
          "durationMs": 86400000
        },
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "gridSettings": {
          "filter": true
        }
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "LargerContent"
      },
      "name": "query - 4",
      "styleSettings": {
        "showBorder": true
      }
    },
    {
      "type": 3,
      "content": {
        "version": "KqlItem/1.0",
        "query": "DiskSize_CL\r\n| project Computer=ComputerName_s, ['FreeSpace percent']=HardDiskFreeSpacePercent_d, ['OneDrive percent']=ODUsedSizePercent_d, ['OneDrive Size']=OneDriveSizeOnDiskMb_d,\r\n['Desktop size']=DesktopSizeOnDiskMb_d, ['Documents size']=DocumentsSizeOnDiskMb_d, ['Pictures size']=PicturesSizeOnDiskMb_d",
        "size": 4,
        "title": "Devices OneDrive size on disk details",
        "timeContext": {
          "durationMs": 86400000
        },
        "queryType": 0,
        "resourceType": "microsoft.operationalinsights/workspaces",
        "gridSettings": {
          "formatters": [
            {
              "columnMatch": "FreeSpace percent",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": "<",
                    "thresholdValue": "10",
                    "representation": "redBright",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "<",
                    "thresholdValue": "20",
                    "representation": "orange",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": ">",
                    "thresholdValue": "20",
                    "representation": "green",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "text": "{0}{1}"
                  }
                ]
              },
              "numberFormat": {
                "unit": 1,
                "options": {
                  "style": "decimal"
                }
              }
            },
            {
              "columnMatch": "OneDrive percent",
              "formatter": 0,
              "numberFormat": {
                "unit": 1,
                "options": {
                  "style": "decimal"
                }
              }
            },
            {
              "columnMatch": "OneDrive Size",
              "formatter": 0,
              "numberFormat": {
                "unit": 4,
                "options": {
                  "style": "decimal"
                }
              }
            },
            {
              "columnMatch": "Desktop size",
              "formatter": 0,
              "numberFormat": {
                "unit": 4,
                "options": {
                  "style": "decimal"
                }
              }
            },
            {
              "columnMatch": "Documents size",
              "formatter": 0,
              "numberFormat": {
                "unit": 4,
                "options": {
                  "style": "decimal"
                }
              }
            },
            {
              "columnMatch": "Pictures size",
              "formatter": 0,
              "numberFormat": {
                "unit": 4,
                "options": {
                  "style": "decimal"
                }
              }
            },
            {
              "columnMatch": "FreeSpace_percent",
              "formatter": 18,
              "formatOptions": {
                "thresholdsOptions": "colors",
                "thresholdsGrid": [
                  {
                    "operator": "<",
                    "thresholdValue": "10",
                    "representation": "redBright",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "<",
                    "thresholdValue": "20",
                    "representation": "orange",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": ">",
                    "thresholdValue": "20",
                    "representation": "green",
                    "text": "{0}{1}"
                  },
                  {
                    "operator": "Default",
                    "thresholdValue": null,
                    "text": "{0}{1}"
                  }
                ]
              },
              "numberFormat": {
                "unit": 1,
                "options": {
                  "style": "decimal"
                }
              }
            },
            {
              "columnMatch": "OneDrive_Percent",
              "formatter": 0,
              "numberFormat": {
                "unit": 1,
                "options": {
                  "style": "decimal"
                }
              }
            },
            {
              "columnMatch": "Desktop_SizeOnDisk",
              "formatter": 0,
              "numberFormat": {
                "unit": 4,
                "options": {
                  "style": "decimal"
                }
              }
            },
            {
              "columnMatch": "Documents_SizeOnDisk",
              "formatter": 0,
              "numberFormat": {
                "unit": 4,
                "options": {
                  "style": "decimal"
                }
              }
            },
            {
              "columnMatch": "Pictures_SizeOnDisk",
              "formatter": 0,
              "numberFormat": {
                "unit": 4,
                "options": {
                  "style": "decimal"
                }
              }
            },
            {
              "columnMatch": "OneDrive_SizeOnDisk",
              "formatter": 0,
              "numberFormat": {
                "unit": 4,
                "options": {
                  "style": "decimal"
                }
              }
            }
          ],
          "filter": true
        }
      },
      "conditionalVisibility": {
        "parameterName": "selectedTab",
        "comparison": "isEqualTo",
        "value": "OneDriveUsage"
      },
      "name": "query - 10",
      "styleSettings": {
        "showBorder": true
      }
    }
  ],
  "$schema": "https://github.com/Microsoft/Application-Insights-Workbooks/blob/master/schema/workbook.json"
}